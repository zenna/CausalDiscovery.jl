(program
  (= GRID_SIZE 8)
  
  (object Particle (: health Bool) (Cell 0 0 (if health then "gray" else "darkgreen")))
                                                      
  (: inactiveParticles (List Particle))
  (= inactiveParticles (initnext (list (Particle true (Position 5 3)) (Particle true (Position 2 1)) (Particle true (Position 4 4)) (Particle true (Position 1 3)) )  
                      (updateObj (prev inactiveParticles) (--> obj (if (! (.. activeParticle health))
                                                                    then (updateObj obj "health" false)
                                                                    else obj)) 
                                                                                                                  (--> obj (adjacent (.. obj origin) (.. (prev activeParticle) origin))))))   
                                                      
  (: activeParticle Particle)
  (= activeParticle (initnext (Particle false (Position 0 0)) (prev activeParticle)))Â 
                                                      
  (on (!= (length (filter (--> obj (! (.. obj health))) (adjacentObjs activeParticle))) 0) (= activeParticle (updateObj (prev activeParticle) "health" false)))
  (on (clicked (prev inactiveParticles)) 
      (let ((= inactiveParticles (addObj (prev inactiveParticles) (prev activeParticle))) 
            (= activeParticle (objClicked click (prev inactiveParticles)))
            (= inactiveParticles (removeObj inactiveParticles (objClicked click (prev inactiveParticles))))
          )))
  (on left (= activeParticle (move (prev activeParticle) -1 0)))
  (on right (= activeParticle (move (prev activeParticle) 1 0)))
  (on up (= activeParticle (move (prev activeParticle) 0 -1)))
  (on down (= activeParticle (move (prev activeParticle) 0 1)))
)
